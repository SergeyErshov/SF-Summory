# üéâ –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç!

### ‚öôÔ∏è –≤–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  


–°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ç—Ä–∏ –í–ú –≤ –æ–±–ª–∞–∫–µ –Ø–Ω–¥–µ–∫—Å:

|        vm        |                 roles               |                                           description                                     |
| ---------------- | ----------------------------------- | ----------------------------------------------------------------------------------------- |
| srv              | deploing, logging, monitoring       | Vm for deploing apps, with logging and moniroting contenerized tools                      |
| kup-master       | master node                         | Master node for Kubernets cluster                                                         |
| kub-app          | worker node                         | Worker node for kubernetes cluster                                                        |

**–°–ø—Ä–∏–Ω—Ç ‚Ññ1**

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ä–µ–¥—ã –≤ –æ–±–ª–∞–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é [terraform](https://github.com/SergeyErshov/SF-Summory/tree/main/terraform)  
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω - —Å –ø–æ–º–æ—â—å—é [Ansible](https://github.com/SergeyErshov/SF-Summory/tree/main/ansible)  

–ü–æ—Ä—è–¥–æ–∫ –¥–µ–ø–ª–æ—è:  

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å ```cd ./terraform && terraform init && terraform apply```
   –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–º–∞–Ω–¥ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã 3 –í–ú, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –≤—ã—à–µ  

2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ ansible
   
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å playbook srv-deploy —Å —Ç–µ–≥–æ–º predeploy ```ansible-playbook -i ./inventory -u <user> --private-key <path_to_key> -t predeploy ./playbooks/srv-deploy.yml```  
   –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–∞ –í–ú srv —É—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã, docker, docker-compose  

4. –í—ã–ø–æ–ª–Ω–∏—Ç—å playbook kub-deploy —Å —Ç–µ–≥–∞–º–∏ kubinstall, master_init ```ansible-playbook -i ./inventory -u <user> --private-key <path_to_key> -t kubinstall -t master_init ./playbooks/srv-deploy.yml```  
   –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–∞ –æ–±–µ –Ω–æ–¥—ã –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã, –∞ —Ç–∞–∫–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–ª–∞—Å—Ç–µ—Ä k8s  

5. –í—ã–ø–æ–ª–Ω–∏—Ç—å playbook kub-deploy —Å —Ç–µ–≥–æ–º worker_join ```ansible-playbook -i ./inventory -u <user> --private-key <path_to_key> -t worker_join ./playbooks/kub-deploy.yml```  
   –í —Ä–µ—â—É–ª—å—Ç–∞—Ç–µ worker –Ω–æ–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–æ–µ–Ω–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä  

6. –í—ã–ø–æ–ª–Ω–∏—Ç—å playbook kub-deploy —Å —Ç–µ–≥–æ–º master_cni ```ansible-playbook -i ./inventory -u <user> --private-key <path_to_key> -t master_cni ./playbooks/kub-deploy.yml```  
   –í —Ä–µ—â—É–ª—å—Ç–∞—Ç–µ –Ω–∞ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥–µ –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞

7. –ó–∞–π—Ç–∏ –Ω–∞ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥—É –ø–æ SSH, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É–∑–ª–æ–≤ –∫–∞–ª—Å—Ç–µ—Ä–∞ –∫–æ–º–∞–Ω–¥–æ–π ```kubectl get nodes```. –í –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω –º–∞—Å—Ç–µ—Ä –∏ –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä, –æ–±–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º Ready  

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞:  

| hostname | role | internal ip |
| ------------------ | ------------------------- | ------------------ |
| master.ru-central1.internal | master-node | 10.128.0.35 |
| worker.ru-central1.internal | worker      | 10.128.0.21 |

–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –∫ —Ä–∞–±–æ—Ç–µ, —Å–ø—Ä–∏–Ω—Ç ‚Ññ1 –∑–∞–≤–µ—Ä—à–µ–Ω

**–°–ø—Ä–∏–Ω—Ç ‚Ññ2**

1. –î–æ–ø–æ–ª–Ω—è–µ–º playbook srv-deploy.yml —Å–µ–∫—Ü–∏–µ–π —Å–±–æ—Ä–∫–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ srv. –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–º –≤ —Ñ–∞–π–ª–µ .var, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .metadata, –∫–æ—Ç–æ—Ä–æ—è –∏—Å–∫–ª—é—á–µ–Ω–∞
   –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è git. –§–∞–π–ª .var –ø–µ—Ä–µ–¥–∞–µ–º –≤ docker-compose –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π env_file.   

   ![env_file](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/1_env_file.png "env_file")  

2. –í—ã–ø–æ–ª–Ω—è–µ–º playbook srv-deploy —Å —Ç–µ–≥–æ–º app_deploy ```ansible-playbook -i ./inventory -u <user> --private-key <path_to_key> -t app_deploy ./playbooks/srv-deploy.yml```  
   
3. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä srv –∏ –¥–µ–ø–ª–æ–∏–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é docker-compose ```docker-compose up -d``` –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–Ω—è–ª–æ—Å—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥ docker-compose
   –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—Ç—Å—É—Ç—Å–≤–∏—è –æ—à–∏–±–æ–∫.  

4.  –î–æ–ø–æ–ª–Ω—è–µ–º playbook srv-deploy.yml —Å–µ–∫—Ü–∏–µ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ gitlab-runner –Ω–∞ –º–∞—à–∏–Ω—É srv. –í—ã–ø–æ–ª–Ω—è–µ–º playbook ```ansible-playbook -i ./inventory -u <user> --private-key <path_to_key> -t runner_inst ./playbooks/srv-deploy.yml```  

5. –í GitLab —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π [–ø—Ä–æ–µ–∫—Ç](https://gitlab.com/sf-devops32/fs-summury) –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤ –Ω–µ–º CI, –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω.    

6. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ srv, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–∞—à —Ä–∞–Ω–Ω–µ—Ä, –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤ GitLab.  

7. –°–æ–∑–¥–∞–µ–º [pipeline](https://github.com/SergeyErshov/SF-Summory/blob/main/.gitlab-ci.yml), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ –ø—É—à–µ –Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –±–∏–ª–¥–∏—Ç—å –Ω–∞—à–µ     –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—É—à–∏—Ç—å –µ–≥–æ –≤ –¥–æ–∫–µ—Ä—Ö–∞–± —Å —Ç–µ–º —Ç–µ–≥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∑–∞–ø—É—à–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.  
   
8. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ kubernetes, –≤—ã–ø–æ–ª–Ω–∏–º playbook kub-deploy.yml —Å —Ç–µ–≥–æ–º manifest –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –Ω–∞ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥—É.  
   
9. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ master –Ω–æ–¥–µ –ø–æ ssh, —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –Ω–µ–π–º—Å–ø–µ–π—Å –¥–ª—è –Ω–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞–º–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º ```kubectl apply -f .```. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–¥—ã —Å –Ω–∞—à–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –ø–æ–¥–Ω—è–ª–∏—Å—å –∫–æ–º–∞–Ω–¥–æ–π ```kubectl get pods```   
    
10. –í—ã–ø–æ–ª–Ω—è–µ–º ```ansible-playbook -i ./inventory -u esm --private-key ~/.ssh/id_ed25519 -t helm ./playbooks/kub-deploy.yml``` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ helm –Ω–∞ –º–∞—Å—Ç–µ—Ä-–Ω–æ–¥—É.  

11. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É helm-—á–∞—Ä—Ç–∞ –∏–∑ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤.  
    
12. –í—ã–ø–æ–ª–Ω—è–µ–º ```ansible-playbook -i ./inventory -u esm --private-key ~/.ssh/id_ed25519 -t helm_chart ./playbooks/kub-deploy.yml``` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è helm-—á–∞—Ä—Ç–∞ –Ω–∞ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥—É.  

13. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–ª ssh –∫ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥–µ, —É–¥–∞–ª—è–µ–º –≤—Å–µ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤ —Ç–µ–∫—É—â–µ–º –Ω–∞–π–º—Å–ø–µ–π—Å–µ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –Ω–∞—à–∏–º helm-—á–∞—Ä—Ç–æ–º –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º ```helm upgrade --install myapp .```  

14. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–¥—ã —Å –Ω–∞—à–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –ø–æ–¥–Ω—è–ª–∏—Å—å –∫–æ–º–∞–Ω–¥–æ–π ```kubectl get pods```. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   
15. –î–µ–ø–ª–æ–∏–º ingress controller –Ω–∞ –º–∞—Å—Ç–µ—Ä –Ω–æ–¥–µ ```kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml```  

16. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∞–≥–µ–Ω—Ç–∞ gitlab –ø–æ [—ç—Ç–æ–º—É –º–∞–Ω—É–∞–ª—É](https://docs.gitlab.com/ee/user/clusters/agent/install/index.html) (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ helm —á–∞—Ä—Ç –∞–≥–µ–Ω—Ç–∞ –ø–æ–ª—É—á–∞–µ–º [–æ—Ç—Å—é–¥–∞](https://cloud.yandex.com/en/docs/managed-kubernetes/operations/applications/gitlab-agent))  

17. –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º helm chart –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∞—Ä—Ö–∏–≤ ```helm package ./myapp/chart/``` –∏ –∑–∞–ª–∏–≤–∞–µ–º –≤ –∞—Ä—Ö–∏–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.  

18. –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–¥–∏—é –¥–µ–ø–ª–æ—è –≤ [pipeline](https://gitlab.com/sf-devops32/fs-summury/-/blob/main/.gitlab-ci.yml) –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.  
    
19. –° –ø–æ–º–æ—â—å—é –∑–∞–ø—É—Å–∫–∞ [playbook](https://github.com/SergeyErshov/SF-Summory/blob/main/ansible/playbooks/srv-deploy.yml) —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ srv kubectl –∏ helm, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–ª–∞—Å—Ç–µ—Ä—É.  
   
20. –°–æ—Ö—Ä–∞–Ω—è–µ–º kubeconfig –≤ —Ñ–∞–π–ª /usr/share/config –∏ –¥–∞–µ–º –Ω–∞ –Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è gitlab-runner.  

21. –ó–∞–ª–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ pipeline –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –¥–æ–∂–∏–¥–∞–µ–º—Å—è –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.  

22. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–∞–¥–∏–∏ pipeline —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–±–æ—Ç–∞–ª–∏:  
    ![pipeline_result](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/2_pipeline_result.png "pipeline_result")  

    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–¥–µ–ø–ª–æ–∏–ª–æ—Å—å –≤ –∫–ª–∞—Å—Ç–µ—Ä —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π –±–∏–ª–¥–∞:  
    ![pods](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/3_pods.png "pods")  

    –ê —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–¥–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–µ:  
    ![web](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/4_myapp_web.png "web")

–°–ø—Ä–∏–Ω—Ç ‚Ññ2 –∑–∞–≤–µ—Ä—à–µ–Ω

**–°–ø—Ä–∏–Ω—Ç ‚Ññ3**

1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –í –∫–∞—á–µ—Å—Ç–≤–µ logshipper –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fluentd, –ª–æ–≥–∏ –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —Ö–æ—Å—Ç–µ srv –≤ elasticksearch –≤ —Å–≤—è–∑–∫–µ —Å kibana.  

2. –†–∞–∑–≤–µ—Ä–Ω–µ–º ELK-—Å—Ç–µ–∫ –Ω–∞ –í–ú srv. –ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å docker-compose. –ü–æ–¥–≥–æ—Ç–æ–≤–ª–∏–≤–∞–µ–º docker-compose.yml –∏ –∑–∞–∫–∏–¥—ã–≤–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≤—ã–ø–æ–ª–Ω—è—è –ø–ª–µ–π–±—É–∫ srv-deploy.yml —Å —Ç–µ–≥–æ–º elk.  

3. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ srv –∏ –ø–æ–¥–Ω–∏–º–∞–µ–º docker-compose, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–≤ –ø–µ—Ä–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è $ELK_PASS –¥–ª—è kibana.  

4. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è fluentd –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ kubernetes. –ü—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º [—ç—Ç–æ—Ç –º–∞–Ω—É–∞–ª](https://mcs.mail.ru/docs/additionals/cases/cases-logs/case-fluentd), –ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ [—ç—Ç–æ–º—É –º–∞–Ω—É–∞–ª—É](https://ryanwilliams.blog/post/2021-04-17-logging-fluentd-and-aks/), –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –ø–æ–¥ —Å–µ–±—è –ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É [github](https://github.com/fluent/fluentd-kubernetes-daemonset).  

5. –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–π–±—É–∫ kub-deploy.yml —Å —Ç–µ–≥–æ–º fluentd –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä.  
   
6. –î–µ–ø–ª–æ–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–¥ –ø–æ–¥–Ω—è–ª—Å—è, –≤ –ª–æ–≥–µ –Ω–µ—Ç –æ—à–∏–±–æ–∫:  
   
![fluentd](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/5_fluentd_pod.png "fluentd")  

7. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ä—É–µ–º—Å—è –≤ kibana, –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω–∞–±–ª—é–¥–∞–µ–º –ª–æ–≥–∏ —Å –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ (–∫–∞–∫ —Å–∞–º–æ–≥–æ, —Ç–∞–∫ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤):  

![kibana](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/6_kibana.png "kibana")

8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –í –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–æ–≤ –º–µ—Ç—Ä–∏–∫ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Grafana. –≠—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π, –∫ —Ç–æ–º—É –∂–µ, –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞–ª–µ—Ä—Ç—ã. –î–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º prometheus stack. –°–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–∞–π—Ç–µ –±—É–¥–µ–º —Å –ø–æ–º–æ—â—å—é blackbox. –ê–ª–µ—Ä—Ç—ã –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ telegram.  

9. –°–æ–∑–¥–∞–µ–º –≤ telegram –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∏ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω.  

9.  –†–∞–∑–≤–µ—Ä–Ω–µ–º Grafana –Ω–∞ –í–ú srv. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º docker-compose, –∞ —Ç–∞–∫–∂–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏. –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—Å–µ —Å–æ–±–µ—Ä–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ monitoring.  

10. –ó–∞–ø—É—Å–∫–∞–µ–º playbook srv-deploy.yml —Å —Ç–µ–≥–æ–º grafana –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ –Ω–∞ srv.  

11. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ srv –∏ –ø–æ–¥–Ω–∏–º–∞–µ–º docker-compose –∏–∑ –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏–∏ /usr/data/monitoring. –î–æ–∂–∏–¥–∞–µ–º—Å—è —Å—Ç–∞—Ä—Ç–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.  
    
12. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É grafana, –¥–æ–±–∞–≤–ª—è–µ–º datasource node-explorer, —Å–æ–∑–¥–∞–µ–º –¥–∞—à–±–æ—Ä–¥ —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –Ω–∞–º –º–µ—Ç—Ä–∏–∫–∞–º–∏. –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞ —Å–∞–π—Ç–∞ –ø–æ–ª—É—á–∞–µ–º —Å –ø–æ–º–æ—â—å—é blackbox.  

13. –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–ª–∞—Å—Ç–µ—Ä–∞ kubernetes. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è prometheus –≤ –∫–ª–∞—Å—Ç–µ—Ä k8s –ø–æ [—ç—Ç–æ–º—É](https://devopscube.com/setup-prometheus-monitoring-on-kubernetes/) –∏ [—ç—Ç–æ–º—É](https://devopscube.com/setup-kube-state-metrics/#:~:text=What%20is%20Kube%20State%20Metrics%3F,stability%20as%20the%20Kubernetes%20API.) –º–∞–Ω—É–∞–ª–∞–º.  

14. –ó–∞–ø—É—Å–∫–∞–µ–º playbook kube-deploy.yml —Å —Ç–µ–≥–æ–º prometheus –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –Ω–∞ –º–∞—Å—Ç–µ—Ä-–Ω–æ–¥—É.  

15. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –ø–æ–¥–Ω—è–ª–æ—Å—å. –ò–¥–µ–º –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å grafana, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à datasource (prometheus in kubernetes). –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–µ –¥–∞–∂–±–æ—Ä–¥—ã k8s –∫–ª–∞—Å—Ç–µ—Ä–∞, –¥–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–µ –Ω–∞–º –≤ –Ω–∞—à –¥–∞—à–±–æ—Ä–¥:  
    ![Mydashbord](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/7_mydashbord.png "mydashbord")  

16. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è –≤ –µ–≥–æ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:
    ![alert](https://github.com/SergeyErshov/SF-Summory/blob/main/RAW/8_telegramm_alert.png "alert")

–ù–∞ —ç—Ç–æ–º —Å–ø—Ä–∏–Ω—Ç ‚Ññ3 –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –æ–∫–æ–Ω—á–µ–Ω–Ω—ã–º

**P.S. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://84.252.130.109/**







